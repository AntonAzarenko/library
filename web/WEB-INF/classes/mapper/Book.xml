<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="library.dao.BookDao">

	<resultMap type="Book" id="bookmap">
		<id column="book_id" property="id" />
		<result column="book_title" property="title" />

	</resultMap>

	<select id="find" resultMap="bookmap" parameterType="string">
		SELECT * FROM books WHERE title = #{title}
	</select>

	<select id="findByAuthorId" parameterType="long"
		resultMap="bookmap">
		SELECT
		b.id AS book_id,
		b.title AS book_title,
		a.id AS
		author_id,
		a.name AS author_name
		FROM books b, authors a
		INNER JOIN authors_books AS ab ON ab.author_id =
		a.id
		WHERE
		a.id = #{id}
	</select>

	<select id="findBooksByPublisher" parameterType="string"
		resultMap="bookmap">
		SELECT
		b.id AS book_id,
		b.title AS book_title,
		p.id AS
		publisher_id,
		p.name AS publishers_name
		FROM books b
		JOIN publishers p ON
		p.id = b.publisher_id
		WHERE
		p.name = #{name}
	</select>

	<select id="getBooks" resultMap="bookmap">
		SELECT b.id, b.name FROM books b
	</select>


	<insert id="create" parameterType="Book" useGeneratedKeys="true"
		keyProperty="id">
		INSERT INTO books (title, publisher_id) VALUES (#{Book.title}, #{Book.publisher.id})
	</insert>

	<select id="read" resultMap="bookmap" parameterType="long">
		SELECT * FROM
		books WHERE id = #{id}
	</select>

	<update id="update" parameterType="Book">
		UPDATE books SET title = #{Book.title}, publisher_id =
		#{Book.publisher.id}, author = #{Book.author} <!-- НЕ УВЕРЕН ЧТО СРАБОТАЕТ -->
	</update>

	<delete id="delete" parameterType="long">
		DELETE FROM books WHERE id =
		#{id}
	</delete>
</mapper>